(function(){var c,e,d,b,a,g=function(a,h){return function(){return a.apply(h,arguments)}};c=jQuery;e=function(){function a(h){this.minLength=h;this.lastValue=this.value="";this.emptyValues=[]}a.prototype.getValue=function(){return this.value};a.prototype.setValue=function(a){this.lastValue=this.value;return this.value=a};a.prototype.hasChanged=function(){return this.value!==this.lastValue};a.prototype.markEmpty=function(){return this.emptyValues.push(this.value)};a.prototype.willHaveResults=function(){return this._isValid()&&
!this._isEmpty()};a.prototype._isValid=function(){return this.value.length>=this.minLength};a.prototype._isEmpty=function(){var a,f,c,b;b=this.emptyValues;f=0;for(c=b.length;f<c;f++)if(a=b[f],this.value.slice(0,a.length)===a)return!0;return!1};return a}();b=function(){function a(f,c,b,g){this.term=c;this.data=b;this.type=g;this.id=""+f+"-soulmate-suggestion";this.index=f}a.prototype.select=function(a){return a(this.term,this.data,this.type,this.index,this.id)};a.prototype.focus=function(){return this.element().addClass("focus")};
a.prototype.blur=function(){return this.element().removeClass("focus")};a.prototype.render=function(a){return'<li id="'+this.id+'" class="soulmate-suggestion">\n  '+a(this.term,this.data,this.type,this.index,this.id)+"\n</li>"};a.prototype.element=function(){return c("#"+this.id)};return a}();a=function(){function a(c,b){this.renderCallback=c;this.selectCallback=b;this.focusedIndex=-1;this.suggestions=[]}a.prototype.update=function(a){var c,g,f,e,d;this.suggestions=[];c=0;d=[];for(f in a)e=a[f],d.push(function(){var a,
h,d;d=[];a=0;for(h=e.length;a<h;a++)g=e[a],this.suggestions.push(new b(c,g.name,g.data,f)),d.push(c+=1);return d}.call(this));return d};a.prototype.blurAll=function(){var a,c,b,g,f;this.focusedIndex=-1;g=this.suggestions;f=[];c=0;for(b=g.length;c<b;c++)a=g[c],f.push(a.blur());return f};a.prototype.render=function(){var a,c,b,g,f,d;a="";if(this.suggestions.length){b=null;d=this.suggestions;g=0;for(f=d.length;g<f;g++){c=d[g];if(c.type!==b)b!==null&&(a+=this._renderTypeEnd(b)),b=c.type,a+=this._renderTypeStart();
a+=this._renderSuggestion(c)}a+=this._renderTypeEnd(b)}return a};a.prototype.count=function(){return this.suggestions.length};a.prototype.focus=function(a){if(a<this.count())return this.blurAll(),a<0?this.focusedIndex=-1:(this.suggestions[a].focus(),this.focusedIndex=a)};a.prototype.focusElement=function(a){return this.focus(parseInt(c(a).attr("id")))};a.prototype.focusNext=function(){return this.focus(this.focusedIndex+1)};a.prototype.focusPrevious=function(){return this.focus(this.focusedIndex-
1)};a.prototype.selectFocused=function(){if(this.focusedIndex>=0)return this.suggestions[this.focusedIndex].select(this.selectCallback)};a.prototype.allBlured=function(){return this.focusedIndex===-1};a.prototype._renderTypeStart=function(){return'<li class="soulmate-type-container">\n  <ul class="soulmate-type-suggestions">'};a.prototype._renderTypeEnd=function(a){return'  </ul>\n  <div class="soulmate-type">'+a+"</div>\n</li>"};a.prototype._renderSuggestion=function(a){return a.render(this.renderCallback)};
return a}();d=function(){function b(f,d){var h,j,k,l,i,m,n,o;this.input=f;this.handleKeyup=g(this.handleKeyup,this);this.handleKeydown=g(this.handleKeydown,this);i=this;o=d.url;n=d.types;k=d.renderCallback;l=d.selectCallback;h=d.maxResults;j=d.minQueryLength;m=d.timeout;this.url=o;this.types=n;this.maxResults=h;this.timeout=m||500;this.xhr=null;this.suggestions=new a(k,l);this.query=new e(j);this.container=c("ul#soulmate").length>0?c("ul#soulmate"):c('<ul id="soulmate">').insertAfter(this.input);
this.container.delegate(".soulmate-suggestion",{mouseover:function(){return i.suggestions.focusElement(this)},click:function(a){a.preventDefault();i.suggestions.selectFocused();return i.input.focus()}});this.input.keydown(this.handleKeydown).keyup(this.handleKeyup).mouseover(function(){return i.suggestions.blurAll()})}var d;d={9:"tab",13:"enter",27:"escape",38:"up",40:"down"};b.prototype.handleKeydown=function(a){var b;b=!0;switch(d[a.keyCode]){case "escape":this.hideContainer();break;case "tab":this.suggestions.selectFocused();
break;case "enter":this.suggestions.selectFocused();this.suggestions.allBlured()&&(b=!1);break;case "up":this.suggestions.focusPrevious();break;case "down":this.suggestions.focusNext();break;default:b=!1}if(b)return a.stopImmediatePropagation(),a.preventDefault()};b.prototype.handleKeyup=function(){this.query.setValue(this.input.val());if(this.query.hasChanged())return this.query.willHaveResults()?(this.suggestions.blurAll(),this.fetchResults()):this.hideContainer()};b.prototype.hideContainer=function(){this.suggestions.blurAll();
this.container.hide();return c(document).unbind("click.soulmate")};b.prototype.showContainer=function(){var a=this;this.container.show();return c(document).bind("click.soulmate",function(b){if(!a.container.has(c(b.target)).length)return a.hideContainer()})};b.prototype.fetchResults=function(){var a=this;this.xhr!=null&&this.xhr.abort();return this.xhr=c.ajax({url:this.url+this.query.getValue(),contentType:"application/json",type:"GET",success:function(b){return a.update(b.results)}})};b.prototype.update=
function(a){this.suggestions.update(a);return this.suggestions.count()>0?(this.container.html(c(this.suggestions.render())),this.showContainer()):(this.query.markEmpty(),this.hideContainer())};return b}();c.fn.soulmate=function(a){new d(c(this),a);return c(this)};window._test={Query:e,Suggestion:b,SuggestionCollection:a,Soulmate:d}}).call(this);this.DocuMeds={Url:null,Views:{},Controllers:{},Collections:{},Models:{},Functions:{},init:function(){Backbone.history.start();return!1}};
$(function(){DocuMeds.init();DocuMeds.Functions.applyDefaultText("autocomplete","Asprin, Valium, Zanax...");$("#autocomplete").soulmate({url:"/autocomplete/",types:["medication"],renderCallback:function(c){return c},selectCallback:function(c){return console.log("Selected "+c)},minQueryLength:2,maxResults:5});$(".numUp").live("click",function(){var c,e;c=$(this).parent().prev("input");e=new String(parseInt(c.val())+1);c.val(e[0]);return!1});return $(".numDown").live("click",function(){var c,e;c=$(this).prev().parent().prev("input");
e=parseInt(c.val());e!==0&&(e=new String(e-1),c.val(e[0]));return!1})});
(function(){var c,e,d=Object.prototype.hasOwnProperty,b=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a};c=function(){function a(){a.__super__.constructor.apply(this,arguments)}b(a,Backbone.Router);a.prototype.routes={items:"index","items/add/:id/:name":"add"};a.prototype.index=function(){var a;return DocuMeds.Collections.Items.length===0?DocuMeds.Collections.Items.fetch({success:function(){return(new DocuMeds.Views.Items({collection:DocuMeds.Collections.Items,
el:$("#itemList")})).render()}}):(a=new DocuMeds.Views.Items({collection:DocuMeds.Collections.Items}),a.render())};a.prototype.add=function(a,b){return dust.render("items_dosage",{id:a,name:b},function(a,b){$("#modal").html(b);$("#dosage").modal({backdrop:!0,show:!0});return $("#medName").jTruncate({length:10,minTrail:0,ellipsisText:"..."})})};a.prototype.create=function(a){return DocuMeds.Collections.Items.create({medication_id:a},{wait:!0})};return a}();DocuMeds.Controllers.Items=new c;c=function(){function a(){a.__super__.constructor.apply(this,
arguments)}b(a,Backbone.Model);a.prototype.defaults={};a.prototype.name="item";a.prototype.initialize=function(){return this.set({cid:this.cid})};a.prototype.url=function(){return"/items"};return a}();DocuMeds.Models.Item=c;c=function(){function a(){a.__super__.constructor.apply(this,arguments)}b(a,Backbone.Collection);a.prototype.model=DocuMeds.Models.Item;a.prototype.url=function(){return"/items"};return a}();DocuMeds.Collections.Items=new c;e=function(){function a(){a.__super__.constructor.apply(this,
arguments)}b(a,Backbone.View);a.prototype.initialize=function(){this.render=_.bind(this.render,this);return this.model.bind("change:name",this.render)};a.prototype.render=function(){var a;a=this;dust.render("items_row",this.model.toJSON(),function(b,c){return a.el=c});return this};return a}();c=function(){function a(){a.__super__.constructor.apply(this,arguments)}b(a,Backbone.View);a.prototype.initialize=function(){_(this).bindAll("add","remove");this._itemViews=[];this.collection.each(this.add);
this.collection.bind("add",this.add);return this.collection.bind("remove",this.remove)};a.prototype.add=function(a){a=new e({model:a});this._itemViews.push(a);if(this._rendered)return $(this.el).append(a.render().el)};a.prototype.remove=function(a){var b;b=_(this._itemViews).select(function(){return cv.model===a})[0];this._itemViews=_(this._itemViews).without(b);if(this._rendered)return $(b.el).remove()};a.prototype.render=function(){var a;a=this;this._rendered=!0;$(this.el).empty();_(this._itemViews).each(function(b){return $(a.el).append(b.render().el)});
return this};return a}();DocuMeds.Views.Items=c}).call(this);
(function(){var c,e,d;DocuMeds.Functions.getUrlParameters=function(){return d({},c)};DocuMeds.Functions.getUrlParameter=function(b){return DocuMeds.Functions.getUrlParameters()[b]};DocuMeds.Functions.paramsContain=function(b){var a;a=d([],e);return _.include(a,b)};d=function(b,a){var c;c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");_.each(c,function(c){c=c.split("=");return a(b,c)});return b};DocuMeds.Functions.readCookie=function(b){var a,c,d;d=b+"=";a=document.cookie.split(";");
for(c=0;c<a.length;){for(b=a[c];b.charAt(0)===" ";)b=b.substring(1,b.length);if(b.indexOf(d)===0)return b.substring(d.length,b.length).replace(/"/g,"");c++}return a};DocuMeds.Functions.setCookie=function(b,a){var c;c=new Date("2015-01-01 12:00:00");return document.cookie=b+"="+escape(a)+";expires="+c.toGMTString()};e=function(b,a){return b.push(a[0])};c=function(b,a){return b[a[0]]=a[1]};DocuMeds.Functions.applyDefaultText=function(b,a){b=document.getElementById(b);if(b===null||b===void 0)return!1;
b.style.color="#9d9d9d";if(b.value==="")b.value=a;b.onfocus=function(){if(this.value===a)return this.value=this.style.color=""};return b.onblur=function(){if(this.value==="")return this.style.color="#9d9d9d",this.value=a}}}).call(this);(function(){function c(c,d){return c.write("<tr><td>").reference(d.get("name"),d,"h").write('</td><td><a href="#">Remove</a></td></tr>')}dust.register("items_row",c);return c})();
(function(){function c(c,d){return c.write('<li><a href="#items/add/').reference(d.get("id"),d,"h").write("/").reference(d.get("name"),d,"h").write('" class="right add">Add</a><a href=\'/medication/show/').reference(d.get("id"),d,"h").write("'>").reference(d.get("name"),d,"h").write("</a></li>")}dust.register("autocomplete_result",c);return c})();

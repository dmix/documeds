(function(){var b,e,c,d,a,g=function(a,h){return function(){return a.apply(h,arguments)}};b=jQuery;e=function(){function a(h){this.minLength=h;this.lastValue=this.value="";this.emptyValues=[]}a.prototype.getValue=function(){return this.value};a.prototype.setValue=function(a){this.lastValue=this.value;return this.value=a};a.prototype.hasChanged=function(){return this.value!==this.lastValue};a.prototype.markEmpty=function(){return this.emptyValues.push(this.value)};a.prototype.willHaveResults=function(){return this._isValid()&&
!this._isEmpty()};a.prototype._isValid=function(){return this.value.length>=this.minLength};a.prototype._isEmpty=function(){var a,f,b,d;d=this.emptyValues;f=0;for(b=d.length;f<b;f++)if(a=d[f],this.value.slice(0,a.length)===a)return!0;return!1};return a}();d=function(){function a(b,f,d,g){this.term=f;this.data=d;this.type=g;this.id=""+b+"-soulmate-suggestion";this.index=b}a.prototype.select=function(a){return a(this.term,this.data,this.type,this.index,this.id)};a.prototype.focus=function(){return this.element().addClass("focus")};
a.prototype.blur=function(){return this.element().removeClass("focus")};a.prototype.render=function(a){return'<li id="'+this.id+'" class="soulmate-suggestion">\n  '+a(this.term,this.data,this.type,this.index,this.id)+"\n</li>"};a.prototype.element=function(){return b("#"+this.id)};return a}();a=function(){function a(b,d){this.renderCallback=b;this.selectCallback=d;this.focusedIndex=-1;this.suggestions=[]}a.prototype.update=function(a){var b,g,f,e,c;this.suggestions=[];b=0;c=[];for(f in a)e=a[f],c.push(function(){var a,
h,c;c=[];a=0;for(h=e.length;a<h;a++)g=e[a],this.suggestions.push(new d(b,g.name,g.data,f)),c.push(b+=1);return c}.call(this));return c};a.prototype.blurAll=function(){var a,b,d,g,f;this.focusedIndex=-1;g=this.suggestions;f=[];b=0;for(d=g.length;b<d;b++)a=g[b],f.push(a.blur());return f};a.prototype.render=function(){var a,b,d,g,f,c;a="";if(this.suggestions.length){d=null;c=this.suggestions;g=0;for(f=c.length;g<f;g++){b=c[g];if(b.type!==d)d!==null&&(a+=this._renderTypeEnd(d)),d=b.type,a+=this._renderTypeStart();
a+=this._renderSuggestion(b)}a+=this._renderTypeEnd(d)}return a};a.prototype.count=function(){return this.suggestions.length};a.prototype.focus=function(a){if(a<this.count())return this.blurAll(),a<0?this.focusedIndex=-1:(this.suggestions[a].focus(),this.focusedIndex=a)};a.prototype.focusElement=function(a){return this.focus(parseInt(b(a).attr("id")))};a.prototype.focusNext=function(){return this.focus(this.focusedIndex+1)};a.prototype.focusPrevious=function(){return this.focus(this.focusedIndex-
1)};a.prototype.selectFocused=function(){if(this.focusedIndex>=0)return this.suggestions[this.focusedIndex].select(this.selectCallback)};a.prototype.allBlured=function(){return this.focusedIndex===-1};a.prototype._renderTypeStart=function(){return'<li class="soulmate-type-container">\n  <ul class="soulmate-type-suggestions">'};a.prototype._renderTypeEnd=function(a){return'  </ul>\n  <div class="soulmate-type">'+a+"</div>\n</li>"};a.prototype._renderSuggestion=function(a){return a.render(this.renderCallback)};
return a}();c=function(){function d(f,c){var h,j,k,l,i,m,n,o;this.input=f;this.handleKeyup=g(this.handleKeyup,this);this.handleKeydown=g(this.handleKeydown,this);i=this;o=c.url;n=c.types;k=c.renderCallback;l=c.selectCallback;h=c.maxResults;j=c.minQueryLength;m=c.timeout;this.url=o;this.types=n;this.maxResults=h;this.timeout=m||500;this.xhr=null;this.suggestions=new a(k,l);this.query=new e(j);this.container=b("ul#soulmate").length>0?b("ul#soulmate"):b('<ul id="soulmate">').insertAfter(this.input);
this.container.delegate(".soulmate-suggestion",{mouseover:function(){return i.suggestions.focusElement(this)},click:function(a){a.preventDefault();i.suggestions.selectFocused();return i.input.focus()}});this.input.keydown(this.handleKeydown).keyup(this.handleKeyup).mouseover(function(){return i.suggestions.blurAll()})}var c;c={9:"tab",13:"enter",27:"escape",38:"up",40:"down"};d.prototype.handleKeydown=function(a){var b;b=!0;switch(c[a.keyCode]){case "escape":this.hideContainer();break;case "tab":this.suggestions.selectFocused();
break;case "enter":this.suggestions.selectFocused();this.suggestions.allBlured()&&(b=!1);break;case "up":this.suggestions.focusPrevious();break;case "down":this.suggestions.focusNext();break;default:b=!1}if(b)return a.stopImmediatePropagation(),a.preventDefault()};d.prototype.handleKeyup=function(){this.query.setValue(this.input.val());if(this.query.hasChanged())return this.query.willHaveResults()?(this.suggestions.blurAll(),this.fetchResults()):this.hideContainer()};d.prototype.hideContainer=function(){this.suggestions.blurAll();
this.container.hide();return b(document).unbind("click.soulmate")};d.prototype.showContainer=function(){var a=this;this.container.show();return b(document).bind("click.soulmate",function(d){if(!a.container.has(b(d.target)).length)return a.hideContainer()})};d.prototype.fetchResults=function(){var a=this;b("#autocomplete").addClass("loading");this.xhr!=null&&this.xhr.abort();return this.xhr=b.ajax({url:this.url+this.query.getValue(),contentType:"application/json",type:"GET",success:function(d){a.update(d.results);
return b("#autocomplete").removeClass("loading")}})};d.prototype.update=function(a){this.suggestions.update(a);return this.suggestions.count()>0?(this.container.html(b(this.suggestions.render())),this.showContainer()):(this.query.markEmpty(),this.hideContainer())};return d}();b.fn.soulmate=function(a){new c(b(this),a);return b(this)};window._test={Query:e,Suggestion:d,SuggestionCollection:a,Soulmate:c}}).call(this);this.DocuMeds={Views:{},Controllers:{},Collections:{},Models:{},Functions:{},init:function(){return Backbone.history.start()}};
$(function(){DocuMeds.init();DocuMeds.Functions.applyDefaultText("autocomplete","Asprin, Valium, Zanax...");$("#autocomplete").soulmate({url:"/autocomplete/",types:["medication"],renderCallback:function(b){return b},selectCallback:function(b){return console.log("Selected "+b)},minQueryLength:2,maxResults:5});$(".numUp").live("click",function(){var b,e;b=$(this).parent().prev("input");e=new String(parseInt(b.val())+1);b.val(e[0]);return!1});return $(".numDown").live("click",function(){var b,e;b=$(this).prev().parent().prev("input");
e=parseInt(b.val());e!==0&&(e=new String(e-1),b.val(e[0]));return!1})});
(function(){var b,e,c=Object.prototype.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);d.prototype=b.prototype;a.prototype=new d;a.__super__=b.prototype;return a};b=function(){function a(){a.__super__.constructor.apply(this,arguments)}d(a,Backbone.Router);a.prototype.routes={items:"index","items/add/:id/:name":"add"};a.prototype.index=function(){var a;return DocuMeds.Collections.Items.length===0?DocuMeds.Collections.Items.fetch({success:function(){return(new DocuMeds.Views.Items({collection:DocuMeds.Collections.Items,
el:$("#itemList")})).render()}}):(a=new DocuMeds.Views.Items({collection:DocuMeds.Collections.Items}),a.render())};a.prototype.add=function(a,b){return dust.render("items_dosage",{id:a,name:b},function(a,b){$("#modal").html(b);$("#dosage").modal({backdrop:!0,show:!0});return $("#medName").jTruncate({length:10,minTrail:0,ellipsisText:"..."})})};a.prototype.create=function(a){return DocuMeds.Collections.Items.create({medication_id:a},{wait:!0})};return a}();DocuMeds.Controllers.Items=new b;b=function(){function a(){a.__super__.constructor.apply(this,
arguments)}d(a,Backbone.Model);a.prototype.defaults={};a.prototype.name="item";a.prototype.initialize=function(){return this.set({cid:this.cid})};a.prototype.url=function(){return"/items"};return a}();DocuMeds.Models.Item=b;b=function(){function a(){a.__super__.constructor.apply(this,arguments)}d(a,Backbone.Collection);a.prototype.model=DocuMeds.Models.Item;a.prototype.url=function(){return"/items"};return a}();DocuMeds.Collections.Items=new b;e=function(){function a(){a.__super__.constructor.apply(this,
arguments)}d(a,Backbone.View);a.prototype.initialize=function(){this.render=_.bind(this.render,this);return this.model.bind("change:name",this.render)};a.prototype.render=function(){var a;a=this;dust.render("items_row",this.model.toJSON(),function(b,d){return a.el=d});return this};return a}();b=function(){function a(){a.__super__.constructor.apply(this,arguments)}d(a,Backbone.View);a.prototype.initialize=function(){_(this).bindAll("add","remove");this._itemViews=[];this.collection.each(this.add);
this.collection.bind("add",this.add);return this.collection.bind("remove",this.remove)};a.prototype.add=function(a){a=new e({model:a});this._itemViews.push(a);if(this._rendered)return $(this.el).append(a.render().el)};a.prototype.remove=function(a){var b;b=_(this._itemViews).select(function(){return cv.model===a})[0];this._itemViews=_(this._itemViews).without(b);if(this._rendered)return $(b.el).remove()};a.prototype.render=function(){var a;a=this;this._rendered=!0;$(this.el).empty();_(this._itemViews).each(function(b){return $(a.el).append(b.render().el)});
return this};return a}();DocuMeds.Views.Items=b}).call(this);
(function(){var b,e,c;DocuMeds.Functions.getUrlParameters=function(){return c({},b)};DocuMeds.Functions.getUrlParameter=function(b){return DocuMeds.Functions.getUrlParameters()[b]};DocuMeds.Functions.paramsContain=function(b){var a;a=c([],e);return _.include(a,b)};c=function(b,a){var c;c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");_.each(c,function(c){c=c.split("=");return a(b,c)});return b};DocuMeds.Functions.readCookie=function(b){var a,c,e;e=b+"=";a=document.cookie.split(";");
for(c=0;c<a.length;){for(b=a[c];b.charAt(0)===" ";)b=b.substring(1,b.length);if(b.indexOf(e)===0)return b.substring(e.length,b.length).replace(/"/g,"");c++}return a};DocuMeds.Functions.setCookie=function(b,a){var c;c=new Date("2015-01-01 12:00:00");return document.cookie=b+"="+escape(a)+";expires="+c.toGMTString()};e=function(b,a){return b.push(a[0])};b=function(b,a){return b[a[0]]=a[1]};DocuMeds.Functions.applyDefaultText=function(b,a){b=document.getElementById(b);if(b===null||b===void 0)return!1;
b.style.color="#9d9d9d";if(b.value==="")b.value=a;b.onfocus=function(){if(this.value===a)return this.value=this.style.color=""};return b.onblur=function(){if(this.value==="")return this.style.color="#9d9d9d",this.value=a}}}).call(this);(function(){function b(b,c){return b.write("<tr><td>").reference(c.get("name"),c,"h").write('</td><td><a href="#">Remove</a></td></tr>')}dust.register("items_row",b);return b})();
(function(){function b(b,c){return b.write('<li><a href="#items/add/').reference(c.get("id"),c,"h").write("/").reference(c.get("name"),c,"h").write('" class="right add">Add</a><a href=\'/medication/show/').reference(c.get("id"),c,"h").write("'>").reference(c.get("name"),c,"h").write("</a></li>")}dust.register("autocomplete_result",b);return b})();
